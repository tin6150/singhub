# Singularity definition file to contain Dell RACADM 
# runs on CentOS 7

# Early test
# main motivation is to run 
# /opt/dell/srvadmin/sbin/racadm set BIOS.ProcSettings.LogicalProc Disabled
# /opt/dell/srvadmin/sbin/racadm jobqueue create BIOS.Setup.1-1
# /opt/dell/srvadmin/sbin/racadm serveraction powercycle
# but the install into vNFS didnt work for some odd reasons
# so trying a container-based install and see if it works better.
#
# Adopted from https://github.com/singularityware/singularity/blob/master/examples/centos.def
#
# this .def file result in x GB image
#

BootStrap: yum
OSVersion: 7

MirrorURL: http://mirror.centos.org/centos-%{OSVERSION}/%{OSVERSION}/os/$basearch/
Include: yum

%runscript
    /opt/dell/srvadmin/sbin/racadm

%post
	yum -y install bash tar gzip bzip2 wget curl coreutils util-linux-ng which less vi
	#yum -y install util-linux-ng        # u/mount, etc
	cd /opt
    	wget -nc https://downloads.dell.com/FOLDER04162301M/1/OM-SrvAdmin-Dell-Web-LX-8.5.0-2372.RHEL7.x86_64_A00.tar.gz -O racadm.tgz
	tar xzf racadm.tgz 
	cd linux/RPMS/supportRPMS/srvadmin/RHEL7/x86_64
	for F in $( ls -1 *rpm ); do rpm -ivh --nodeps $F; done
