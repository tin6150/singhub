
# singularity container definition for
# Knime hosted on ubuntu 

# Knime download require registration and agreement to to EULA.
# This singularity container is for POC.  
# If you use this, please register your at knime.com

## TBA: file rename to knime when posting to singularity-hub

BootStrap: debootstrap
OSVersion: trusty
MirrorURL: http://us.archive.ubuntu.com/ubuntu/


%runscript
    echo "Please register at Knime.com when using knime from this Proof of Concept Container"


%post
    echo "Hello from inside the container"
    sed -i 's/$/ universe/' /etc/apt/sources.list
    apt-get -y --force-yes install vim
    apt-get -y --force-yes install ncurses-term
    #apt-get -y --force-yes install gedit
    apt-get -y --force-yes install less
    apt-get -y --force-yes install wget
    apt-get -y --force-yes install curl
    #apt-get -y --force-yes install git
    apt-get -y --force-yes install tar
    apt-get -y --force-yes install bzip2
    apt-get -y --force-yes install coreutils
    apt-get -y --force-yes install python
    apt-get -y --force-yes install zlib1g-dev zlib1g
    apt-get -y --force-yes install libgtk-3-0 libgtk2.0-0

    touch /THIS_IS_INSIDE_SINGULARITY

    cd /opt
    # download knime from a temporary location.
    # after POC, need to work out with Greg Landrum et co on way to download from knime.com and get user registration and agreement.
    KNIME_GZ=knime_3.4.0.linux.gtk.x86_64.tar.gz 
    ##[[ -f $KNIME_GZ ]] || curl https://drive.google.com/file/d/0B1kImCblq9CeRjFranJnV2lCb00/view?usp=sharing -o $KNIME_GZ 
    ##[[ -f $KNIME_GZ ]] || curl https://www.dropbox.com/s/lyzmfu3y6q1x06k/knime_3.4.0.linux.gtk.x86_64.tar.gz?dl=0 -o $KNIME_GZ 
    [[ -f $KNIME_GZ ]] || wget https://www.dropbox.com/s/lyzmfu3y6q1x06k/knime_3.4.0.linux.gtk.x86_64.tar.gz?dl=0 -O $KNIME_GZ 
    tar xfz $KNIME_GZ

    # http://subdom.ask-margo.com/cache_tmp/knime_3.4.0.linux.gtk.x86_64.tar.gz

